
// ---- Start of ShopEaseBackendApplication.java ----
package com.shopease.backend;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class ShopEaseBackendApplication {

	public static void main(String[] args) {
		SpringApplication.run(ShopEaseBackendApplication.class, args);
	}

}

// ---- End of ShopEaseBackendApplication.java ----


// ---- Start of AppConfig.java ----
package com.shopease.backend.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;

@Configuration
public class AppConfig 
{
	@Bean
	public PasswordEncoder passwordEncoder()
	{
		return new BCryptPasswordEncoder();
	}
}

/*
PasswordEncoder (BCrypt)
What is it?

It is a component that encrypts (hashes) passwords before storing them in the database.
We never store plain passwords.
*/

/*
Why BCrypt?
BCrypt:

Adds salt automatically 
Slow hashing → prevents brute force attacks 
Industry standard for authentication
 */


// ---- End of AppConfig.java ----


// ---- Start of SecurityConfig.java ----
package com.shopease.backend.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpMethod;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
import org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;

import com.shopease.backend.security.JwtAuthenticationFilter;

@Configuration
@EnableMethodSecurity
public class SecurityConfig 
{
	private final JwtAuthenticationFilter jwtAuthFilter;
	
	public SecurityConfig(JwtAuthenticationFilter jwtAuthFilter) 
	{
        this.jwtAuthFilter = jwtAuthFilter;
    }
	
	@Bean
	public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception
	{
		http.csrf(csrf -> csrf.disable());
		
		http.sessionManagement(session ->
								session.sessionCreationPolicy(SessionCreationPolicy.STATELESS));
		
		http.authorizeHttpRequests(auth -> auth
				// Public endpoints (login, register)
		        .requestMatchers("/auth/**").permitAll()

		        .requestMatchers(HttpMethod.GET, "/products/**").permitAll()
		        .requestMatchers("/products/**").hasRole("ADMIN")
		        
		        // ADMIN ONLY
		        //.requestMatchers("/products/**").hasRole("ADMIN")
		        .requestMatchers("/api/categories/**").hasRole("ADMIN")

		        // Customer OR Admin
		        .requestMatchers("/cart/**", "/orders/**").hasAnyRole("CUSTOMER", "ADMIN")

		        // Everything else must be authenticated
		        .anyRequest().authenticated());
		
		http.addFilterBefore(jwtAuthFilter, UsernamePasswordAuthenticationFilter.class);
		
		return http.build();
	}
	
	@Bean
	public AuthenticationManager authenticationmanager(AuthenticationConfiguration config) throws Exception
	{
		return config.getAuthenticationManager();
	}
}




















// ---- End of SecurityConfig.java ----


// ---- Start of AddressController.java ----
package com.shopease.backend.controller;

import java.util.List;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.shopease.backend.entity.Address;
import com.shopease.backend.security.AuthUtil;
import com.shopease.backend.service.AddressService;

@RestController
@RequestMapping("/address")
public class AddressController 
{
    private final AddressService addressService;
    private final AuthUtil authUtil;
    
	public AddressController(AddressService addressService, AuthUtil authUtil) 
	{
		this.addressService = addressService;
		this.authUtil = authUtil;
	}
    
    public ResponseEntity<Address> addAddress(@RequestBody Address address)
    {
    	String email = authUtil.getLoggedInEmail();
    	Address saved = addressService.addAddress(email, address);
    	return ResponseEntity.ok(saved);
    }
    
    @GetMapping
    public ResponseEntity<List<Address>> getAddresses() 
    {
        String email = authUtil.getLoggedInEmail();
        return ResponseEntity.ok(addressService.getAddresses(email));
    }

    @PutMapping("/{id}")
    public ResponseEntity<Address> updateAddress(@PathVariable Long id, @RequestBody Address address) 
    {
        Address updated = addressService.updateAddress(id, address);
        return (updated == null) ? ResponseEntity.notFound().build() : ResponseEntity.ok(updated);
    }

    @DeleteMapping("/{id}")
    public ResponseEntity<?> deleteAddress(@PathVariable Long id) 
    {
        boolean ok = addressService.deleteAddress(id);
        return ok ? ResponseEntity.ok("Address deleted") : ResponseEntity.notFound().build();
    }
}

// ---- End of AddressController.java ----


// ---- Start of AuthController.java ----
package com.shopease.backend.controller;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.shopease.backend.dto.AuthenticationRequest;
import com.shopease.backend.dto.AuthenticationResponse;
import com.shopease.backend.dto.RegisterRequest;
import com.shopease.backend.service.AuthService;

@RestController
@RequestMapping("/auth")
public class AuthController 
{
	private final AuthService authService;

	public AuthController(AuthService authService) 
	{
		this.authService = authService;
	}
	
	// REGISTER
	@PostMapping("/register")
	public ResponseEntity<AuthenticationResponse> register(@RequestBody  RegisterRequest request)
	{
		return ResponseEntity.ok(authService.register(request));
	}
	
	 // LOGIN
	@PostMapping("/login")
	public ResponseEntity<AuthenticationResponse> login(@RequestBody AuthenticationRequest request)
	{
		return ResponseEntity.ok(authService.login(request));
	}
}

// ---- End of AuthController.java ----


// ---- Start of CartController.java ----
package com.shopease.backend.controller;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.shopease.backend.entity.Cart;
import com.shopease.backend.service.CartService;

@RestController
@RequestMapping("/cart")
public class CartController
{
    private final CartService cartService;

    public CartController(CartService cartService)
    {
        this.cartService = cartService;
    }
	
	// Get cart for user
	@GetMapping
	public ResponseEntity<Cart> getCart()
	{
		return ResponseEntity.ok(cartService.getCart());
	}
	
	// Add product to cart
    @PostMapping("/add/{productId}/{quantity}")
    public ResponseEntity<Cart> addProductToCart(
    		@PathVariable Long productId,
    		@PathVariable int quantity)
    {
    	Cart cart = cartService.addProductToCart(productId, quantity);
    	
    	if(cart==null)
    		return ResponseEntity.notFound().build();
    	
		return ResponseEntity.ok(cart);
    }
    
    // Remove cart item
    @DeleteMapping("/remove/{cartItemId}")
    public ResponseEntity<Cart> removeItem(
    		@PathVariable Long cartItemId)
    {
    	Cart cart = cartService.removeItemFromCart(cartItemId);
    	return ResponseEntity.ok(cart);
    }
}











// ---- End of CartController.java ----


// ---- Start of CategoryController.java ----
package com.shopease.backend.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.shopease.backend.entity.Category;
import com.shopease.backend.service.CategoryService;

@RestController
@RequestMapping("api/categories")
public class CategoryController 
{
	@Autowired
	private CategoryService categoryService;
	
	// Create Category
	@PostMapping
	@PreAuthorize("hasRole('ADMIN')")
	public Category createCategory(@RequestBody Category category)
	{
		return categoryService.createCategory(category);
	}
	
	// Get All Categories
    @GetMapping
    public List<Category> getAllCategories() 
    {
        return categoryService.getAllCategories();
    }
}

// ---- End of CategoryController.java ----


// ---- Start of OrderController.java ----
package com.shopease.backend.controller;

import java.util.List;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.shopease.backend.entity.Order;
import com.shopease.backend.security.AuthUtil;
import com.shopease.backend.service.OrderService;

@RestController
@RequestMapping("/orders")
public class OrderController 
{
	private final OrderService orderService;
	private final AuthUtil authUtil;
	
	public OrderController(OrderService orderService,AuthUtil authUtil)
	{
		this.orderService = orderService;
		this.authUtil = authUtil;
	}
	
	@PostMapping("/place/{addressId}")
	public ResponseEntity<Order> placeOrder(@PathVariable Long addressId)
	{
		String email = authUtil.getLoggedInEmail();
		Order order = orderService.placeOrder(email,addressId);
		
		if(order == null)
			return ResponseEntity.badRequest().build();
		
		return ResponseEntity.ok(order);
	}
	
	@GetMapping
	public ResponseEntity<List<Order>> getUserOrders()
	{
		String email = authUtil.getLoggedInEmail();
		List<Order> orders = orderService.getOrdersByUser(email);
		return ResponseEntity.ok(orders);
	}
	
	@GetMapping("/{orderId}")
	public ResponseEntity<Order> getOrderById(@PathVariable Long orderId)
	{
		Order order = orderService.getOrderById(orderId);
		
		if (order == null)
			return ResponseEntity.notFound().build();
		
		return ResponseEntity.ok(order);
	}
	
	@PutMapping("/cancel/{orderId}")
	public ResponseEntity<?> cancelOrder(@PathVariable Long orderId)
	{
		Order cancelledOrder = orderService.cancelOrder(orderId);
		
		if (cancelledOrder == null)
			return ResponseEntity.badRequest().body("Cannot cancel this order");
		
		return ResponseEntity.ok(cancelledOrder);
	}
}

// ---- End of OrderController.java ----


// ---- Start of ProductController.java ----
package com.shopease.backend.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.shopease.backend.entity.Product;
import com.shopease.backend.service.ProductService;

@RestController
@RequestMapping("/products")
public class ProductController 
{
	@Autowired
	ProductService productService;
	
	// Add Product
	@PostMapping
	@PreAuthorize("hasRole('ADMIN')")
	public ResponseEntity<Product> addProduct(@RequestBody Product product)
	{
		Product saved = productService.addProduct(product);
		return ResponseEntity.ok(saved);
	}
	
	// Get All Products
	@GetMapping
	public ResponseEntity<List<Product>> getAllProducts()
	{
		return ResponseEntity.ok(productService.getAllProducts());
	}
	
	// Get Product By ID
	@GetMapping("/{id}")
	public ResponseEntity<Product> getProduct(@PathVariable Long id)
	{
		Product product = productService.getProductById(id);
		if(product == null)
		{
			return ResponseEntity.notFound().build();
		}
		return ResponseEntity.ok(product);
	}
	
	// Update Product By ID
    @PutMapping("/{id}")
    @PreAuthorize("hasRole('ADMIN')")
    public ResponseEntity<Product> updateProduct(@PathVariable Long id,@RequestBody Product updatedProduct) 
    {
        Product product = productService.updateProduct(id, updatedProduct);
        if (product == null) {
            return ResponseEntity.notFound().build();
        }
        return ResponseEntity.ok(product);
    }
    
	// Delete Product
	@DeleteMapping("/{id}")
	@PreAuthorize("hasRole('ADMIN')")
	public ResponseEntity<String> deleteProduct(@PathVariable Long id)
	{
		productService.deleteProduct(id);
		return ResponseEntity.ok("Product deleted Successfully");
	}
}

// ---- End of ProductController.java ----


// ---- Start of AuthenticationRequest.java ----
package com.shopease.backend.dto;

public class AuthenticationRequest 
{
	private String email;
	private String password;
	
	public String getEmail() {
		return email;
	}
	public void setEmail(String email) {
		this.email = email;
	}
	public String getPassword() {
		return password;
	}
	public void setPassword(String password) {
		this.password = password;
	}
}

/*
>DTOs (Data Transfer Objects) are simple classes used ONLY to exchange data in APIs.
>A Data Transfer Object is a design pattern that allows for the exchange of data 
between software application subsystems or layers.
*/
// ---- End of AuthenticationRequest.java ----


// ---- Start of AuthenticationResponse.java ----
package com.shopease.backend.dto;

public class AuthenticationResponse 
{
    private String token;
    private String message;
    
	public AuthenticationResponse(String token, String message) 
	{
		this.token = token;
		this.message = message;
	}

	public String getToken() {
		return token;
	}

	public String getMessage() {
		return message;
	}
    
    
}

// ---- End of AuthenticationResponse.java ----


// ---- Start of RegisterRequest.java ----
package com.shopease.backend.dto;

import com.shopease.backend.entity.Role;

public class RegisterRequest
{
    private String name;
    private String email;
    private String password;
    private Role role;
    
	public String getName() {
		return name;
	}
	public void setName(String name) {
		this.name = name;
	}
	public String getEmail() {
		return email;
	}
	public void setEmail(String email) {
		this.email = email;
	}
	public String getPassword() {
		return password;
	}
	public void setPassword(String password) {
		this.password = password;
	}
	public Role getRole() {
		return role;
	}
	public void setRole(Role role) {
		this.role = role;
	}
    
    
}

// ---- End of RegisterRequest.java ----


// ---- Start of Address.java ----
package com.shopease.backend.entity;

import jakarta.persistence.*;

@Entity
public class Address 
{
	@Id
	@GeneratedValue(strategy=GenerationType.IDENTITY)
	private Long id;
	private String fullName; //Receiver name
	private String line1;
	private String line2;
	private String city;
	private String state;
	private String pincode;
	private String phone;
	
	@ManyToOne
	@JoinColumn(name="user_id")
	private User user;
	
	public Address() {}

	public Long getId() {
		return id;
	}

	public void setId(Long id) {
		this.id = id;
	}

	public String getFullName() {
		return fullName;
	}

	public void setFullName(String fullName) {
		this.fullName = fullName;
	}

	public String getLine1() {
		return line1;
	}

	public void setLine1(String line1) {
		this.line1 = line1;
	}

	public String getLine2() {
		return line2;
	}

	public void setLine2(String line2) {
		this.line2 = line2;
	}

	public String getCity() {
		return city;
	}

	public void setCity(String city) {
		this.city = city;
	}

	public String getState() {
		return state;
	}

	public void setState(String state) {
		this.state = state;
	}

	public String getPincode() {
		return pincode;
	}

	public void setPincode(String pincode) {
		this.pincode = pincode;
	}

	public String getPhone() {
		return phone;
	}

	public void setPhone(String phone) {
		this.phone = phone;
	}

	public User getUser() {
		return user;
	}

	public void setUser(User user) {
		this.user = user;
	}
	
	
}

// ---- End of Address.java ----


// ---- Start of Cart.java ----
package com.shopease.backend.entity;

import java.util.List;

import jakarta.persistence.CascadeType;
import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.JoinColumn;
import jakarta.persistence.OneToMany;
import jakarta.persistence.OneToOne;
import jakarta.persistence.Table;

@Entity
@Table(name="carts")
public class Cart 
{
	@Id
	@GeneratedValue(strategy=GenerationType.IDENTITY)
	private Long id;
	
	@OneToOne
	@JoinColumn(name="user_id")
	private User user;
	
	@OneToMany(mappedBy="cart",cascade=CascadeType.ALL, orphanRemoval=true)
	private List<CartItem> cartItems;
	
	private double totalPrice;

	public Long getId() {
		return id;
	}

	public void setId(Long id) {
		this.id = id;
	}

	public User getUser() {
		return user;
	}

	public void setUser(User user) {
		this.user = user;
	}

	public List<CartItem> getCartItems() {
		return cartItems;
	}

	public void setCartItems(List<CartItem> cartItems) {
		this.cartItems = cartItems;
	}

	public double getTotalPrice() {
		return totalPrice;
	}

	public void setTotalPrice(double totalPrice) {
		this.totalPrice = totalPrice;
	}
	
	
	
}

// ---- End of Cart.java ----


// ---- Start of CartItem.java ----
package com.shopease.backend.entity;

import com.fasterxml.jackson.annotation.JsonIgnore;

import jakarta.persistence.*;

@Entity
@Table(name="cart_items")
public class CartItem 
{
	@Id
	@GeneratedValue(strategy=GenerationType.IDENTITY)
	private Long id;
	
	@ManyToOne
	@JoinColumn(name="cart_id")
	@JsonIgnore
	private Cart cart; // Each CartItem belongs to a Cart
	
	@ManyToOne
	@JoinColumn(name="product_id")
	private Product product; // Each CartItem points to a Product
	
	private int quantity;
	
	private double price; // price = product.price * quantity

	public Long getId() {
		return id;
	}

	public void setId(Long id) {
		this.id = id;
	}

	public Cart getCart() {
		return cart;
	}

	public void setCart(Cart cart) {
		this.cart = cart;
	}

	public Product getProduct() {
		return product;
	}

	public void setProduct(Product product) {
		this.product = product;
	}

	public int getQuantity() {
		return quantity;
	}

	public void setQuantity(int quantity) {
		this.quantity = quantity;
	}

	public double getPrice() {
		return price;
	}

	public void setPrice(double price) {
		this.price = price;
	}
	
	
}

// ---- End of CartItem.java ----


// ---- Start of Category.java ----
package com.shopease.backend.entity;

import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.Table;

@Entity
@Table(name="categories")
public class Category 
{
	@Id
	@GeneratedValue(strategy=GenerationType.IDENTITY)
	private Long id;
	
	@Column(nullable=false,unique=true)
	private String name;
	
	private String description;

	public Category() {	}

	public Category(String name, String description) 
	{
		this.name = name;
		this.description = description;
	}
	
    public Long getId() 
    {
        return id;
    }
	
    public String getName() 
    {
        return name;
    }

    public void setName(String name) 
    {
        this.name = name;
    }

    public String getDescription() 
    {
        return description;
    }

    public void setDescription(String description) 
    {
        this.description = description;
    }
	
    
}

// ---- End of Category.java ----


// ---- Start of Order.java ----
package com.shopease.backend.entity;

import java.time.LocalDateTime;
import java.util.List;

import com.fasterxml.jackson.annotation.JsonManagedReference;

import jakarta.persistence.CascadeType;
import jakarta.persistence.Entity;
import jakarta.persistence.EnumType;
import jakarta.persistence.Enumerated;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.JoinColumn;
import jakarta.persistence.ManyToOne;
import jakarta.persistence.OneToMany;
import jakarta.persistence.Table;

@Entity
@Table(name="orders")
public class Order
{
	@Id
	@GeneratedValue(strategy=GenerationType.IDENTITY)
	private Long id;
	
	// User who placed the order
	@ManyToOne
	@JoinColumn(name="user_id")
	private User user;
	
	// Order items
	@OneToMany(mappedBy="order", cascade=CascadeType.ALL)
	@JsonManagedReference
	private List<OrderItem> items;
	
    private double totalAmount;

    @Enumerated(EnumType.STRING)
    private OrderStatus status;
 // PENDING, CONFIRMED, SHIPPED, DELIVERED

    private LocalDateTime createdAt;
    
    @ManyToOne
    @JoinColumn(name = "address_id")
    private Address shippingAddress;
    
 // getters & setters
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }

    public User getUser() { return user; }
    public void setUser(User user) { this.user = user; }

    public List<OrderItem> getItems() { return items; }
    public void setItems(List<OrderItem> items) { this.items = items; }

    public double getTotalAmount() { return totalAmount; }
    public void setTotalAmount(double totalAmount) { this.totalAmount = totalAmount; }

    public OrderStatus getStatus() { return status; }
    public void setStatus(OrderStatus status) { this.status = status; }

    public LocalDateTime getCreatedAt() { return createdAt; }
    public void setCreatedAt(LocalDateTime createdAt) { this.createdAt = createdAt; }
	
    public Address getShippingAddress() { return shippingAddress; }
	public void setShippingAddress(Address shippingAddress) { this.shippingAddress = shippingAddress; }
    
    
}

// ---- End of Order.java ----


// ---- Start of OrderItem.java ----
package com.shopease.backend.entity;

import com.fasterxml.jackson.annotation.JsonBackReference;

import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.JoinColumn;
import jakarta.persistence.ManyToOne;
import jakarta.persistence.Table;

@Entity
@Table(name="order_items")
public class OrderItem 
{
	@Id
	@GeneratedValue(strategy=GenerationType.IDENTITY)
	private Long id;
	
	// Order reference
	@ManyToOne
	@JoinColumn(name="order_id")
	@JsonBackReference
	private Order order;
	
	// product ref
	@ManyToOne
	@JoinColumn(name="product_id")
	private Product product;
	
	private int quantity;
    private double price; // quantity * product price
    
    // getters & setters
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }

    public Order getOrder() { return order; }
    public void setOrder(Order order) { this.order = order; }

    public Product getProduct() { return product; }
    public void setProduct(Product product) { this.product = product; }

    public int getQuantity() { return quantity; }
    public void setQuantity(int quantity) { this.quantity = quantity; }

    public double getPrice() { return price; }
    public void setPrice(double price) { this.price = price; }
}

// ---- End of OrderItem.java ----


// ---- Start of OrderStatus.java ----
package com.shopease.backend.entity;

public enum OrderStatus
{
	PENDING,
	CANCELLED
}

// ---- End of OrderStatus.java ----


// ---- Start of Product.java ----
package com.shopease.backend.entity;

import com.fasterxml.jackson.annotation.JsonIgnore;

import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.JoinColumn;
import jakarta.persistence.ManyToOne;
import jakarta.persistence.Table;

@Entity
@Table(name="products")
public class Product 
{
	@Id
	@GeneratedValue(strategy=GenerationType.IDENTITY)
	private Long id;
	
	private String name;
	
	private String description;
	
	private double price;
	
	@ManyToOne
	@JoinColumn(name="category_id")
	@JsonIgnore
	private Category category;
	
	public Product()
	{
	}

	public Product(String name, String description, double price, Category category)
	{
		super();
		this.name = name;
		this.description = description;
		this.price = price;
		this.category = category;
	}

	public Long getId() {
		return id;
	}

	public void setId(Long id) {
		this.id = id;
	}

	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}

	public String getDescription() {
		return description;
	}

	public void setDescription(String description) {
		this.description = description;
	}

	public double getPrice() {
		return price;
	}

	public void setPrice(double price) {
		this.price = price;
	}

	public Category getCategory() {
		return category;
	}

	public void setCategory(Category category) {
		this.category = category;
	}	
	
}

// ---- End of Product.java ----


// ---- Start of Role.java ----
package com.shopease.backend.entity;

public enum Role 
{
	ADMIN,
	CUSTOMER
}

// ---- End of Role.java ----


// ---- Start of User.java ----
package com.shopease.backend.entity;

import java.util.List;

import com.fasterxml.jackson.annotation.JsonIgnore;

import jakarta.persistence.CascadeType;
import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.EnumType;
import jakarta.persistence.Enumerated;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.OneToMany;
import jakarta.persistence.Table;

@Entity
@Table(name="users")
public class User 
{
	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private Long id;
	
	private String name;
	
	@Column(unique=true,nullable=false)
	private String email;
	
	// will store bcrypt hash; hide from JSON responses
    @Column(nullable = false)
    @JsonIgnore
	private String password;
	
    @Enumerated(EnumType.STRING)
	private Role role;//Admin or Customer
	
    @OneToMany(mappedBy = "user", cascade = CascadeType.ALL)
    private List<Address> addresses;
	
    public User(){}

	public User(String name, String email, String password, Role role) 
	{
		this.name = name;
		this.email = email;
		this.password = password;
		this.role = role;
	}

	public long getId() {
		return id;
	}

	public void setId(long id) {
		this.id = id;
	}

	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}

	public String getEmail() {
		return email;
	}

	public void setEmail(String email) {
		this.email = email;
	}

	public String getPassword() {
		return password;
	}

	public void setPassword(String password) {
		this.password = password;
	}

	public Role getRole() {
		return role;
	}

	public void setRole(Role role) {
		this.role = role;
	}

	public List<Address> getAddresses() {
		return addresses;
	}

	public void setAddresses(List<Address> addresses) {
		this.addresses = addresses;
	}

	
}

// ---- End of User.java ----


// ---- Start of AddressRepository.java ----
package com.shopease.backend.repository;

import java.util.List;
import org.springframework.data.jpa.repository.JpaRepository;
import com.shopease.backend.entity.Address;

public interface AddressRepository extends JpaRepository<Address,Long>
{
	List<Address> findByUserId(Long userId);
}
// ---- End of AddressRepository.java ----


// ---- Start of CartItemRepository.java ----
package com.shopease.backend.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import com.shopease.backend.entity.CartItem;

public interface CartItemRepository  extends JpaRepository<CartItem, Long>
{
	CartItem findByCartIdAndProductId(Long cartId, Long productId);
}

// ---- End of CartItemRepository.java ----


// ---- Start of CartRepository.java ----
package com.shopease.backend.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import com.shopease.backend.entity.Cart;
import com.shopease.backend.entity.User;

public interface CartRepository extends JpaRepository<Cart, Long> 
{
	Cart findByUser(User user);
}

// ---- End of CartRepository.java ----


// ---- Start of CategoryRepository.java ----
package com.shopease.backend.repository;

import org.springframework.data.jpa.repository.JpaRepository;

import com.shopease.backend.entity.Category;

public interface CategoryRepository extends JpaRepository<Category,Long>
{
	
}

// ---- End of CategoryRepository.java ----


// ---- Start of OrderItemRepository.java ----
package com.shopease.backend.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import com.shopease.backend.entity.OrderItem;

public interface OrderItemRepository extends JpaRepository<OrderItem, Long> {

}
// ---- End of OrderItemRepository.java ----


// ---- Start of OrderRepository.java ----
package com.shopease.backend.repository;

import java.util.List;
import org.springframework.data.jpa.repository.JpaRepository;

import com.shopease.backend.entity.Order;

public interface OrderRepository extends JpaRepository<Order, Long>
{
	List<Order> findByUserId(Long userId);

}
// ---- End of OrderRepository.java ----


// ---- Start of ProductRepository.java ----
package com.shopease.backend.repository;

import org.springframework.data.jpa.repository.JpaRepository;

import com.shopease.backend.entity.Product;

public interface ProductRepository extends JpaRepository<Product,Long>
{

}

// ---- End of ProductRepository.java ----


// ---- Start of UserRepository.java ----
package com.shopease.backend.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import com.shopease.backend.entity.User;

public interface UserRepository extends JpaRepository<User,Long>
{
	// Custom finder method to find user by email
	User findByEmail(String email);
}


/*
 * What is a Repository? (Simple Explanation)
 * 
 * A repository is a class that talks to the database. Instead of writing SQL
 * manually, Spring JPA lets you access data using methods.
 */
// ---- End of UserRepository.java ----


// ---- Start of AuthUtil.java ----
package com.shopease.backend.security;

import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.stereotype.Component;

@Component
public class AuthUtil 
{
	public String getLoggedInEmail() 
	{
		Authentication auth = SecurityContextHolder.getContext().getAuthentication();
		
		if (auth == null) 
			return null;
		
		return auth.getName(); // our username/email in UserDetails
	}
}
/*
This allows us to get the email of the logged-in user anywhere. Helper method to get logged in user

*/
// ---- End of AuthUtil.java ----


// ---- Start of CustomUserDetailsService.java ----
package com.shopease.backend.security;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;

import com.shopease.backend.entity.User;
import com.shopease.backend.repository.UserRepository;

@Service
public class CustomUserDetailsService implements UserDetailsService
{
	@Autowired
	private UserRepository userRepository;
	
	/*This method is called automatically during login process.
	This converts your own User entity into a Spring Security UserDetails object.
	It maps your custom user → spring security user.
	& return a Spring Security UserDetails object. */
	
	@Override
	public UserDetails loadUserByUsername(String email) throws UsernameNotFoundException 
	{
		User user = userRepository.findByEmail(email);
		
		if (user==null)
			throw new UsernameNotFoundException("User not found: " + email);
		
		return org.springframework.security.core.userdetails.User
				.withUsername(user.getEmail())
				.password(user.getPassword())
				.roles(user.getRole().name())
				.build();
	}
	
}

// ---- End of CustomUserDetailsService.java ----


// ---- Start of JwtAuthenticationFilter.java ----
package com.shopease.backend.security;

import java.io.IOException;

import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.web.authentication.WebAuthenticationDetailsSource;
import org.springframework.stereotype.Component;
import org.springframework.web.filter.OncePerRequestFilter;

import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

@Component
public class JwtAuthenticationFilter extends OncePerRequestFilter
{
	private final JwtService jwtService;
    private final CustomUserDetailsService userDetailsService;

    public JwtAuthenticationFilter(JwtService jwtService, CustomUserDetailsService userDetailsService) 
    {
        this.jwtService = jwtService;
        this.userDetailsService = userDetailsService;
    }
    
	@Override
	protected void doFilterInternal(HttpServletRequest request,
									HttpServletResponse response, 
									FilterChain filterChain)
			throws ServletException, IOException 
	{
		String authHeader = request.getHeader("Authorization");
		
		if (authHeader == null || !authHeader.startsWith("Bearer ")) 
		{
			filterChain.doFilter(request, response);
			return;
		}
		
		String jwt = authHeader.substring(7);
		String email = jwtService.extractUsername(jwt);
		
		if (email != null && SecurityContextHolder.getContext().getAuthentication() == null)
		{
			UserDetails userDetails = userDetailsService.loadUserByUsername(email);
			
			if(jwtService.isTokenValid(jwt, userDetails))
			{
				UsernamePasswordAuthenticationToken authToken = new UsernamePasswordAuthenticationToken(userDetails,null,userDetails.getAuthorities());
				authToken.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));
				
				SecurityContextHolder.getContext().setAuthentication(authToken);
			}	
		}
		filterChain.doFilter(request, response);		
	}
	
}
/*
User → POST /auth/login → gets JWT → stores in localStorage/postman

Every future request:
→ Authorization: Bearer <token>
→ JWT Filter verifies token
→ If valid → Spring Security allows request
→ If invalid → Reject (401 Unauthorized) 
*/

// ---- End of JwtAuthenticationFilter.java ----


// ---- Start of JwtService.java ----
package com.shopease.backend.security;

import java.security.Key;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.stereotype.Service;

import com.shopease.backend.entity.User;

import io.jsonwebtoken.Claims;
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;
import io.jsonwebtoken.security.Keys;

@Service
public class JwtService 
{
	@Value("${jwt.secret}")
	private String secretKey;
	
	@Value("${jwt.expiration}")
	private long jwtExpirationMs;

	/* 	JWT needs a cryptographic key to sign the token.
		We convert your secret key text into a valid Key object. 	 */
	private Key getSignInKey()
	{
		return Keys.hmacShaKeyFor(secretKey.getBytes());
	}
	
	public String generateToken(User user)
	{
		Map<String,Object> claims = new HashMap<>();
		
		claims.put("role", user.getRole().name());
		
		return Jwts.builder()
				.setClaims(claims)
				.setSubject(user.getEmail())
				.setIssuedAt(new Date())
				.setExpiration(new Date(System.currentTimeMillis() + jwtExpirationMs))
				.signWith(getSignInKey(),SignatureAlgorithm.HS256)
				.compact();
	}
	
	/*This verifies:
		>Signature is correct
		>Token is legitimate
		>Not forged*/
	public String extractUsername(String token)
	{
		return extractAllClaims(token).getSubject();
	}
	
	public Claims extractAllClaims(String token)
	{
		return Jwts.parserBuilder()
				.setSigningKey(getSignInKey())
				.build()
				.parseClaimsJws(token)
				.getBody();
	}
	
	// Validates: >Is token not expired? 
	// >Does token belong to this user?
	public boolean isTokenValid(String token, UserDetails  userDetails )
	{
		final String username = extractUsername(token);
		return (username.equals(userDetails.getUsername())) &&
				!isTokenExpired(token);
	}

	private boolean isTokenExpired(String token) 
	{
		return extractAllClaims(token).getExpiration().before(new Date());
	}
}
/*
This class handles creating and validating JWT tokens.

public String generateToken(User user) {}
This creates a token like this:-

Header 
{
    "alg": "HS256"
}

Payload 
{
    "sub": "a@a.com",
    "role": "CUSTOMER",
    "iat": now,
    "exp": 24hrs later
}

Signature 
{
    HMACSHA256(secret)
}
*/
// ---- End of JwtService.java ----


// ---- Start of AddressService.java ----
package com.shopease.backend.service;

import java.util.List;

import org.springframework.stereotype.Service;

import com.shopease.backend.entity.Address;
import com.shopease.backend.entity.User;
import com.shopease.backend.repository.AddressRepository;
import com.shopease.backend.repository.UserRepository;

@Service
public class AddressService 
{
    private final AddressRepository addressRepository;
    private final UserRepository userRepository;
    
	public AddressService(AddressRepository addressRepository, UserRepository userRepository) 
	{
		this.addressRepository = addressRepository;
		this.userRepository = userRepository;
	}
    
    public Address addAddress(String email, Address address)
    {
    	User user = userRepository.findByEmail(email);
    	
    	if (user == null)
    		return null;
    	
    	address.setUser(user);
    	return addressRepository.save(address);
    	
    }
    
    public List<Address> getAddresses(String email)
    {
    	User user = userRepository.findByEmail(email);
    	
    	if (user == null)
    		return null;
    	
    	return addressRepository.findByUserId(user.getId());
    }
    
    public Address updateAddress(Long addressId, Address updated) 
    {
    	Address existing = addressRepository.findById(addressId).orElse(null);
    	
    	if (existing == null)
	    	return null;
    	
    	existing.setFullName(updated.getFullName());
        existing.setLine1(updated.getLine1());
        existing.setLine2(updated.getLine2());
        existing.setCity(updated.getCity());
        existing.setState(updated.getState());
        existing.setPincode(updated.getPincode());
        existing.setPhone(updated.getPhone());

        return addressRepository.save(existing);
    }
    
    public boolean deleteAddress(Long addressId) 
    {
        Address address = addressRepository.findById(addressId).orElse(null);
        if (address == null) 
        	return false;

        addressRepository.delete(address);
        return true;
    }
}

// ---- End of AddressService.java ----


// ---- Start of AuthService.java ----
package com.shopease.backend.service;

import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;

import com.shopease.backend.dto.AuthenticationRequest;
import com.shopease.backend.dto.AuthenticationResponse;
import com.shopease.backend.dto.RegisterRequest;
import com.shopease.backend.entity.User;
import com.shopease.backend.repository.UserRepository;
import com.shopease.backend.security.JwtService;

@Service
public class AuthService 
{
	private UserRepository userRepository;
    private PasswordEncoder passwordEncoder;
    private JwtService jwtService;
    
	public AuthService(UserRepository userRepository, PasswordEncoder passwordEncoder, JwtService jwtService) 
	{
		this.userRepository = userRepository;
		this.passwordEncoder = passwordEncoder;
		this.jwtService = jwtService;
	}
    
    // Registration
	public AuthenticationResponse register(RegisterRequest request)
	{
		User user = new User();
		user.setName(request.getName());
		user.setEmail(request.getEmail());
		user.setPassword(passwordEncoder.encode(request.getPassword()));  // hash password
		user.setRole(request.getRole());
		
		userRepository.save(user);
		
		String token = jwtService.generateToken(user);
		
		return new AuthenticationResponse(token, "User registered Successfully");
	}
	
	// Login
	public AuthenticationResponse login(AuthenticationRequest request)
	{
		User user = userRepository.findByEmail(request.getEmail());
		
		if (user == null)
			return new AuthenticationResponse(null, "Invalid email");
		
		if (!passwordEncoder.matches(request.getPassword(), user.getPassword()))
			return new AuthenticationResponse(null, "Invalid password");
		
		String token = jwtService.generateToken(user);
		
		return new AuthenticationResponse(token, "Login successfull");
			
	}
}

// ---- End of AuthService.java ----


// ---- Start of CartService.java ----
package com.shopease.backend.service;

import java.util.ArrayList;

import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.stereotype.Service;

import com.shopease.backend.entity.Cart;
import com.shopease.backend.entity.CartItem;
import com.shopease.backend.entity.Product;
import com.shopease.backend.entity.User;
import com.shopease.backend.repository.CartItemRepository;
import com.shopease.backend.repository.CartRepository;
import com.shopease.backend.repository.ProductRepository;
import com.shopease.backend.repository.UserRepository;

@Service
public class CartService {

    private final CartRepository cartRepository;
    private final CartItemRepository cartItemRepository;
    private final ProductRepository productRepository;
    private final UserRepository userRepository;

    public CartService(
            CartRepository cartRepository,
            CartItemRepository cartItemRepository,
            ProductRepository productRepository,
            UserRepository userRepository
    ) {
        this.cartRepository = cartRepository;
        this.cartItemRepository = cartItemRepository;
        this.productRepository = productRepository;
        this.userRepository = userRepository;
    }

    private User getLoggedInUser() {
        Authentication auth = SecurityContextHolder.getContext().getAuthentication();
        String email = auth.getName();
        return userRepository.findByEmail(email);
    }

    private double calculateTotal(Cart cart) {
        return cart.getCartItems()
                .stream()
                .mapToDouble(CartItem::getPrice)
                .sum();
    }

    // Get cart of logged-in user
    public Cart getCart() 
    {
        User user = getLoggedInUser();

        Cart cart = cartRepository.findByUser(user);

        if (cart == null) {
            cart = new Cart();
            cart.setUser(user);
            cart.setCartItems(new ArrayList<>());
            cart.setTotalPrice(0);
            cart = cartRepository.save(cart);
        }

        return cart;
    }

    // Add or merge product
    public Cart addProductToCart(Long productId, int quantity) {
        Cart cart = getCart();
        Product product = productRepository.findById(productId).orElse(null);

        if (product == null)
            return null;

        CartItem existing = cartItemRepository.findByCartIdAndProductId(cart.getId(), productId);

        if (existing != null) {
            existing.setQuantity(existing.getQuantity() + quantity);
            existing.setPrice(existing.getQuantity() * product.getPrice());
            cartItemRepository.save(existing);
        } else {
            CartItem item = new CartItem();
            item.setCart(cart);
            item.setProduct(product);
            item.setQuantity(quantity);
            item.setPrice(quantity * product.getPrice());
            cartItemRepository.save(item);

            cart.getCartItems().add(item);
        }

        cart.setTotalPrice(calculateTotal(cart));
        return cartRepository.save(cart);
    }

    public Cart removeItemFromCart(Long cartItemId) {
        Cart cart = getCart();
        CartItem item = cartItemRepository.findById(cartItemId).orElse(null);

        if (item == null)
            return cart;

        cart.getCartItems().remove(item);
        cartItemRepository.delete(item);

        cart.setTotalPrice(calculateTotal(cart));
        return cartRepository.save(cart);
    }
}

// ---- End of CartService.java ----


// ---- Start of CategoryService.java ----
package com.shopease.backend.service;


import java.util.List;

import org.springframework.stereotype.Service;

import com.shopease.backend.entity.Category;
import com.shopease.backend.repository.CategoryRepository;


@Service
public class CategoryService 
{
	private final CategoryRepository categoryRepository;
	
	public CategoryService(CategoryRepository categoryRepository)
	{
		this.categoryRepository = categoryRepository;
	}
	
	public Category createCategory(Category category)
	{
		return categoryRepository.save(category);
	}
	
	public List<Category> getAllCategories()
	{
		return categoryRepository.findAll();
	}
}

// ---- End of CategoryService.java ----


// ---- Start of OrderService.java ----
package com.shopease.backend.service;

import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

import org.springframework.stereotype.Service;

import com.shopease.backend.entity.Address;
import com.shopease.backend.entity.Cart;
import com.shopease.backend.entity.CartItem;
import com.shopease.backend.entity.Order;
import com.shopease.backend.entity.OrderItem;
import com.shopease.backend.entity.OrderStatus;
import com.shopease.backend.entity.User;
import com.shopease.backend.repository.AddressRepository;
import com.shopease.backend.repository.CartRepository;
import com.shopease.backend.repository.OrderRepository;
import com.shopease.backend.repository.UserRepository;

@Service
public class OrderService 
{
    private final OrderRepository orderRepository;
    private final CartRepository cartRepository;
    private final UserRepository userRepository;
    private final AddressRepository addressRepository;
   
    
	public OrderService(OrderRepository orderRepository,
			CartRepository cartRepository, 
			UserRepository userRepository,
			AddressRepository addressRepository) 
	{
		this.orderRepository = orderRepository;
		this.cartRepository = cartRepository;
		this.userRepository = userRepository;
		this.addressRepository = addressRepository;
	}
    
	public Order placeOrder(String email, Long addressId) 
	{
		// Get user
		User user = userRepository.findByEmail(email);
		
		if(user==null)
			return null;
		
		Address address = addressRepository.findById(addressId).orElse(null);
		if (address == null) return null;
		
		Cart cart = cartRepository.findByUser(user);
		
		if(cart.getCartItems().isEmpty())
		{
			return null;  // empty cart
		}
		
		 // Create order
		Order order = new Order();
		order.setUser(user);
		order.setCreatedAt(LocalDateTime.now());
		order.setStatus(OrderStatus.PENDING);
		
		List<OrderItem> orderItems = new ArrayList<>();
		double total = 0;
		
		for (CartItem cartItem: cart.getCartItems())
		{
			OrderItem oi = new OrderItem();
			oi.setOrder(order);
			oi.setProduct(cartItem.getProduct());
			oi.setQuantity(cartItem.getQuantity());
			oi.setPrice(cartItem.getPrice());
			
			total += cartItem.getPrice();
            orderItems.add(oi);
		}
		
		order.setItems(orderItems);
		order.setTotalAmount(total);
		order.setShippingAddress(address);
		
		// Save order and items
		Order saveOrder = orderRepository.save(order);
		
		// clear cart
		cart.getCartItems().clear();
		cart.setTotalPrice(0);
		cartRepository.save(cart);
		
		return saveOrder;
	}
	
	public List<Order> getOrdersByUser(String email) 
	{
	    User user = userRepository.findByEmail(email);
	    if (user == null)
	        return null;

	    return orderRepository.findByUserId(user.getId());
	}

	
	public Order getOrderById(Long orderId)
	{
		return orderRepository.findById(orderId).orElse(null);
	}
	
	public Order cancelOrder(Long orderId)
	{
		Order order = orderRepository.findById(orderId).orElse(null);
		
		if(order == null)
			return null;
		
		if(order.getStatus() != OrderStatus.PENDING)
			return null;
		
		order.setStatus(OrderStatus.CANCELLED);
		
		return orderRepository.save(order);
	}
	
}




// ---- End of OrderService.java ----


// ---- Start of ProductService.java ----
package com.shopease.backend.service;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.shopease.backend.entity.Category;
import com.shopease.backend.entity.Product;
import com.shopease.backend.repository.CategoryRepository;
import com.shopease.backend.repository.ProductRepository;

@Service
public class ProductService 
{
	@Autowired
	ProductRepository productRepository;
	@Autowired
	private CategoryRepository categoryRepository;
	
	//addProduct
	public Product addProduct(Product product)
	{
		Long categoryId = product.getCategory().getId();
		
		Category category = categoryRepository.findById(categoryId)
				.orElseThrow(()->new RuntimeException("Category not found with ID: "+ categoryId));
		
		product.setCategory(category);
		
		return productRepository.save(product);
	}
	
	//getAllProducts
	public List<Product> getAllProducts()
	{
		return productRepository.findAll();
	}
	
	//getProductById
	public Product getProductById(Long id)
	{
		return productRepository.findById(id).orElse(null);
	}
	
	// Update product (including category)
    public Product updateProduct(Long id, Product updatedProduct) 
    {
        Product existing = productRepository.findById(id).orElse(null);

        if (existing == null)
        {
            return null;
        }

        existing.setName(updatedProduct.getName());
        existing.setDescription(updatedProduct.getDescription());
        existing.setPrice(updatedProduct.getPrice());

        // Update category
        if (updatedProduct.getCategory() != null)
        {
            Long categoryId = updatedProduct.getCategory().getId();
            Category category = categoryRepository.findById(categoryId)
                    .orElseThrow(() -> new RuntimeException("Category not found with ID: " + categoryId));
            existing.setCategory(category);
        }

        return productRepository.save(existing);
    }

	
	//deleteProduct
	public void deleteProduct(Long id)
	{
		productRepository.deleteById(id);
	}
}

// ---- End of ProductService.java ----

